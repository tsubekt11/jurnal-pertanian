<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Jurnal Harian Pertanian</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f4f7f4}
header{background:#2f7d32;color:#fff;padding:16px;text-align:center}
header .sub{font-size:14px;opacity:.95}

.card{
  background:#fff;
  margin:12px;
  padding:12px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1)
}

label{font-weight:bold;margin-top:8px;display:block}
input,textarea,select,button{
  width:100%;
  padding:8px;
  margin-top:6px
}

button{
  background:#2f7d32;
  color:#fff;
  border:none;
  border-radius:6px;
  margin-top:12px;
  font-size:15px
}

.hidden{display:none}
hr{margin:10px 0}

.row{display:flex;gap:6px;margin-top:6px}
.no{width:40px}
.nama{flex:1}
.qty{width:60px}
.harga{width:120px}
.total{width:140px;background:#eee}

.invoice{
  font-size:14px;
  padding-left:10px;
  border-left:3px solid #2f7d32;
  margin-top:6px
}
.invoice b{display:block;margin-top:4px}

.rp{font-weight:bold}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<header id="header">
  <h2>ğŸŒ¾ Jurnal Harian Pertanian</h2>
  <div class="sub" id="headerInfo">Data awal musim belum diisi</div>
</header>

<!-- ================= DATA AWAL MUSIM ================= -->
<div class="card" id="dataAwalBox">
  <h3>ğŸ“Œ Data Awal Musim</h3>

  <label>Nama Komoditi</label>
  <input id="komoditi">

  <label>Jumlah Tanaman (batang)</label>
  <input type="number" id="jumlahTanaman">

  <label>Luas Lahan (Ha)</label>
  <input type="number" step="0.01" id="luasLahan">

  <label>Nama Desa</label>
  <input id="desa">

  <label>Lokasi Lahan (Link Google Maps)</label>
  <input id="lokasi">

  <hr>

  <label>Tanggal Mulai Olah Lahan (Hari ke-1)</label>
  <input type="date" id="olah">

  <label>Tanggal Tanam</label>
  <input type="date" id="tanam">

  <button onclick="simpanDataAwal()">ğŸ’¾ Simpan Data Awal</button>
</div>

<!-- ================= TANGGAL CATATAN ================= -->
<div class="card">
  <h3>ğŸ“… Tanggal Catatan</h3>
  <input type="date" id="tanggalCatatan">
</div>

<!-- ================= KEGIATAN ================= -->
<div class="card">
  <h3>ğŸ“˜ Catatan Kegiatan</h3>
  <textarea id="kegiatan" placeholder="Tuliskan kegiatan hari ini..."></textarea>
  <button onclick="simpanKegiatan()">ğŸ’¾ Simpan Kegiatan</button>
</div>

<!-- ================= BIAYA & MODAL ================= -->
<div class="card">
  <h3>ğŸ’° Catatan Biaya & Modal</h3>

  <label>Jenis</label>
  <select id="jenis" onchange="toggleBelanja()">
    <option value="Belanja">Belanja</option>
    <option value="Upah">Upah</option>
    <option value="Modal">Modal</option>
  </select>

  <!-- BELANJA -->
  <div id="belanjaBox" class="hidden">
    <h4>ğŸ§¾ Daftar Belanja</h4>
    <div id="listBelanja"></div>
    <button onclick="tambahItem()">â• Tambah Item Belanja</button>
    <div class="rp" id="grandTotal"></div>
  </div>

  <!-- NON BELANJA -->
  <div id="nonBelanjaBox">
    <label>Keterangan</label>
    <input id="ket">

    <label>Jumlah (Rp)</label>
    <input id="jumlahUang">
  </div>

  <button onclick="simpanBiaya()">ğŸ’¾ Simpan</button>
</div>

<!-- ================= RIWAYAT ================= -->
<div class="card" id="riwayat"></div>

<!-- ================= RINGKASAN ================= -->
<div class="card" id="ringkasan"></div>

<script>
let itemsBelanja=[];

function rupiah(n){
  return "Rp " + (n||0).toLocaleString("id-ID");
}

function formatHari(t){
  return new Date(t).toLocaleDateString("id-ID",
  {weekday:"long",day:"numeric",month:"long",year:"numeric"});
}

/* ================= DATA AWAL ================= */
function simpanDataAwal(){
  const data={
    komoditi:komoditi.value,
    jumlah:jumlahTanaman.value,
    luas:luasLahan.value,
    desa:desa.value,
    lokasi:lokasi.value,
    olah:olah.value,
    tanam:tanam.value
  };
  localStorage.setItem("dataAwal",JSON.stringify(data));
  tampilHeader();
}

function tampilHeader(){
  const d=JSON.parse(localStorage.getItem("dataAwal"));
  if(!d)return;
  headerInfo.innerHTML=`
  <b>${d.komoditi}</b> â€” ${d.jumlah} batang | ${d.luas} Ha<br>
  Desa ${d.desa}<br>
  ğŸŒ± Olah Lahan: ${formatHari(d.olah)}<br>
  ğŸŒ¾ Tanam: ${formatHari(d.tanam)}<br>
  ğŸ“ <a href="${d.lokasi}" target="_blank" style="color:#fff">Lihat Lokasi</a>
  `;
}

/* ================= KEGIATAN ================= */
function simpanKegiatan(){
  const t=tanggalCatatan.value;
  if(!t)return alert("Isi tanggal");
  const data=JSON.parse(localStorage.getItem("kegiatan"))||[];
  data.push({tanggal:t,teks:kegiatan.value});
  localStorage.setItem("kegiatan",JSON.stringify(data));
  tampilRiwayat();
}

/* ================= BELANJA ================= */
function toggleBelanja(){
  const b=jenis.value=="Belanja";
  belanjaBox.classList.toggle("hidden",!b);
  nonBelanjaBox.classList.toggle("hidden",b);
}

function tambahItem(){
  itemsBelanja.push({nama:"",qty:1,harga:0});
  renderBelanja();
}

function renderBelanja(){
  let html="",total=0;
  itemsBelanja.forEach((i,n)=>{
    const sub=i.qty*i.harga; total+=sub;
    html+=`
    <div class="invoice">
      <b>${n+1}. <input class="nama" placeholder="Nama Barang"
        value="${i.nama}" oninput="itemsBelanja[${n}].nama=this.value"></b>
      <div class="row">
        <input class="qty" type="number" value="${i.qty}"
          oninput="itemsBelanja[${n}].qty=this.value;renderBelanja()">
        <input class="harga" type="number" value="${i.harga}"
          oninput="itemsBelanja[${n}].harga=this.value;renderBelanja()">
        <input class="total" disabled value="${rupiah(sub)}">
      </div>
    </div>`;
  });
  listBelanja.innerHTML=html;
  grandTotal.innerText="Grand Total: "+rupiah(total);
}

function simpanBiaya(){
  const t=tanggalCatatan.value;
  if(!t)return alert("Isi tanggal");
  const data=JSON.parse(localStorage.getItem("biaya"))||[];
  if(jenis.value=="Belanja"){
    let total=0;
    itemsBelanja.forEach(i=>total+=i.qty*i.harga);
    data.push({tanggal:t,jenis:"Belanja",items:itemsBelanja,total});
    itemsBelanja=[]; renderBelanja();
  }else{
    data.push({tanggal:t,jenis:jenis.value,ket:ket.value,total:+jumlahUang.value});
  }
  localStorage.setItem("biaya",JSON.stringify(data));
  tampilRiwayat();
}

/* ================= RIWAYAT ================= */
function tampilRiwayat(){
  const keg=JSON.parse(localStorage.getItem("kegiatan"))||[];
  const bi=JSON.parse(localStorage.getItem("biaya"))||[];
  const awal=JSON.parse(localStorage.getItem("dataAwal"))||{};
  let map={};

  keg.forEach(k=>{
    map[k.tanggal]=map[k.tanggal]||{};
    map[k.tanggal].kegiatan=k.teks;
  });

  bi.forEach(b=>{
    map[b.tanggal]=map[b.tanggal]||{};
    map[b.tanggal].biaya=map[b.tanggal].biaya||[];
    map[b.tanggal].biaya.push(b);
  });

  let html="",modal=0,keluar=0;

  Object.keys(map).sort().forEach(t=>{
    const hariKe=awal.olah?Math.floor((new Date(t)-new Date(awal.olah))/86400000)+1:"";
    const hst=awal.tanam?Math.floor((new Date(t)-new Date(awal.tanam))/86400000):"";
    let harian=0;

    html+=`<div class="card"><b>${formatHari(t)}</b>
    <div class="small">Hari ke-${hariKe} | HST ${hst}</div>`;

    if(map[t].kegiatan){
      html+=`<div class="invoice">ğŸ“˜ ${map[t].kegiatan}</div>`;
    }

    (map[t].biaya||[]).forEach(b=>{
      if(b.jenis=="Belanja"){
        harian+=b.total; keluar+=b.total;
        html+=`<div class="invoice">ğŸ§¾ Belanja`;
        b.items.forEach((i,n)=>{
          html+=`<div>${n+1}. ${i.nama} â€” ${i.qty} x ${rupiah(i.harga)} = ${rupiah(i.qty*i.harga)}</div>`;
        });
        html+=`<b>Total Belanja: ${rupiah(b.total)}</b></div>`;
      }
      if(b.jenis=="Upah"){
        harian+=b.total; keluar+=b.total;
        html+=`<div class="invoice">ğŸ‘· Upah: ${b.ket}<br><b>${rupiah(b.total)}</b></div>`;
      }
      if(b.jenis=="Modal"){
        modal+=b.total;
        html+=`<div class="invoice">ğŸ’° Modal Masuk<br><b>${rupiah(b.total)}</b></div>`;
      }
    });

    if(harian>0){
      html+=`<div class="invoice"><b>â• Biaya Harian: ${rupiah(harian)}</b></div>`;
    }

    html+="</div>";
  });

  riwayat.innerHTML="<h3>ğŸ“– Riwayat</h3>"+html;
  ringkasan.innerHTML=`
  <h3>ğŸ“Š Ringkasan</h3>
  Modal Masuk: ${rupiah(modal)}<br>
  Total Biaya: ${rupiah(keluar)}<br>
  <b>Sisa Modal: ${rupiah(modal-keluar)}</b>`;
}

tampilHeader();
tampilRiwayat();
</script>

</body>
</html>
