<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Jurnal Harian Pertanian</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f4f7f4}

/* ===== HEADER ===== */
header{
  background:#2f7d32;
  padding:16px;
  text-align:center;
  color:#ffffff;
}
header *{color:#ffffff !important}

.header-main{font-size:16px;font-weight:bold;margin-top:6px}
.header-sub{font-size:14px}
.header-line{margin:4px 0;font-size:14px}
.header-group{margin:6px 0}
.header-link a{color:#ffffff;text-decoration:underline;font-weight:bold}

#btnEditAwal{
  margin-top:10px;
  background:#ffffff;
  color:#2f7d32 !important;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  font-weight:bold;
}

/* ===== CARD ===== */
.card{
  background:#fff;
  margin:12px;
  padding:12px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1)
}
.hidden{display:none}

label{font-weight:bold;margin-top:8px;display:block}
input,textarea,select,button{
  width:100%;
  padding:8px;
  margin-top:4px
}
textarea{resize:vertical}
button{
  background:#2f7d32;
  color:#fff;
  border:none;
  border-radius:6px;
  margin-top:12px
}

.info-box{
  background:#f0f7f0;
  padding:8px;
  border-radius:6px;
  font-size:14px;
  margin-top:8px
}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<header>
  <h2>üåæ Jurnal Harian Pertanian</h2>

  <div id="headerInfo">
    <div class="header-line">Data awal musim belum diisi</div>
  </div>

  <button id="btnEditAwal" class="hidden" onclick="editAwal()">‚úèÔ∏è Ubah Data Awal</button>
</header>

<!-- ================= DATA AWAL MUSIM ================= -->
<div class="card" id="dataAwalCard">
  <h3>üìå Data Awal Musim</h3>

  <label>Nama Komoditi</label>
  <input id="komoditi">

  <label>Jumlah Tanaman (batang)</label>
  <input id="jumlahTanaman" type="number">

  <label>Luas Lahan (Ha)</label>
  <input id="luasLahan" type="number" step="0.01">

  <label>Nama Desa</label>
  <input id="desa">

  <label>Nama Pemilik Lahan</label>
  <input id="pemilik">

  <label>Status Lahan</label>
  <select id="statusLahan">
    <option value="Hak Milik">Hak Milik</option>
    <option value="Sewa">Sewa</option>
  </select>

  <label>Lokasi Lahan (Link Google Maps)</label>
  <input id="lokasi">

  <label>Tanggal Mulai Olah Lahan (Hari ke-1)</label>
  <input type="date" id="olah">

  <label>Tanggal Tanam</label>
  <input type="date" id="tanam">

  <button onclick="simpanDataAwal()">üíæ Simpan Data Awal</button>
</div>

<!-- ================= CATATAN KEGIATAN HARIAN ================= -->
<div class="card">
  <h3>üìì Catatan Kegiatan Harian</h3>

  <label>Tanggal Kegiatan</label>
  <input type="date" id="tglKegiatan" onchange="hitungHariHST()">

  <label>Jenis Kegiatan</label>
  <select id="jenisKegiatan">
    <option value="">-- Pilih Jenis Kegiatan --</option>
    <option>Olah Lahan</option>
    <option>Tanam</option>
    <option>Pemupukan</option>
    <option>Penyemprotan</option>
    <option>Penyiangan</option>
    <option>Panen</option>
    <option>Lainnya</option>
  </select>

  <label>Uraian Kegiatan</label>
  <textarea id="uraian" placeholder="Contoh: Pemupukan NPK 200 kg/ha, tenaga 4 orang"></textarea>

  <div class="info-box" id="infoHari">
    Hari ke-: - | HST: -
  </div>

  <button onclick="simpanKegiatan()">üíæ Simpan Kegiatan</button>
</div>

<!-- ================= RIWAYAT SEMENTARA ================= -->
<div class="card" id="riwayat"></div>

<script>
/* ===== UTIL ===== */
function formatTanggal(t){
  return new Date(t).toLocaleDateString("id-ID",{
    weekday:"long",day:"numeric",month:"long",year:"numeric"
  });
}
function selisihHari(t1,t2){
  return Math.floor((new Date(t2)-new Date(t1))/(1000*60*60*24))+1;
}

/* ===== DATA AWAL ===== */
function simpanDataAwal(){
  const data={
    komoditi:komoditi.value,
    jumlah:jumlahTanaman.value,
    luas:luasLahan.value,
    desa:desa.value,
    pemilik:pemilik.value,
    status:statusLahan.value,
    lokasi:lokasi.value,
    olah:olah.value,
    tanam:tanam.value
  };
  localStorage.setItem("dataAwal",JSON.stringify(data));
  tampilHeader();
  dataAwalCard.classList.add("hidden");
  btnEditAwal.classList.remove("hidden");
}

function editAwal(){
  const d=JSON.parse(localStorage.getItem("dataAwal"));
  if(!d) return;

  komoditi.value=d.komoditi||"";
  jumlahTanaman.value=d.jumlah||"";
  luasLahan.value=d.luas||"";
  desa.value=d.desa||"";
  pemilik.value=d.pemilik||"";
  statusLahan.value=d.status||"Hak Milik";
  lokasi.value=d.lokasi||"";
  olah.value=d.olah||"";
  tanam.value=d.tanam||"";

  dataAwalCard.classList.remove("hidden");
  window.scrollTo({top:0,behavior:"smooth"});
}

function tampilHeader(){
  const d=JSON.parse(localStorage.getItem("dataAwal"));
  if(!d) return;

  headerInfo.innerHTML=`
    <div class="header-main">${d.komoditi}</div>
    <div class="header-sub">${d.jumlah} batang | ${d.luas} Ha</div>
    <div class="header-line">Pemilik Lahan: ${d.pemilik}</div>
    <div class="header-line">Desa ${d.desa} | <a href="${d.lokasi}" target="_blank">üìç Lihat Lokasi</a></div>
    <div class="header-line">‚õèÔ∏è Olah Lahan: ${formatTanggal(d.olah)}</div>
    <div class="header-line">üå± Tanam: ${formatTanggal(d.tanam)}</div>
  `;
}

/* ===== HITUNG HARI & HST ===== */
function hitungHariHST(){
  const d=JSON.parse(localStorage.getItem("dataAwal"));
  const t=tglKegiatan.value;

  if(!d || !t){
    infoHari.innerText="Hari ke-: - | HST: -";
    return;
  }

  const hariKe = selisihHari(d.olah, t);
  const hst = selisihHari(d.tanam, t);

  infoHari.innerText = `Hari ke-${hariKe} | HST ${hst}`;
}

/* ===== SIMPAN KEGIATAN ===== */
function simpanKegiatan(){
  const d=JSON.parse(localStorage.getItem("dataAwal"));
  if(!d) return alert("Data Awal Musim belum diisi");

  if(!tglKegiatan.value) return alert("Tanggal kegiatan belum dipilih");
  if(!jenisKegiatan.value) return alert("Jenis kegiatan belum dipilih");

  const hariKe = selisihHari(d.olah, tglKegiatan.value);
  const hst = selisihHari(d.tanam, tglKegiatan.value);

  const data=JSON.parse(localStorage.getItem("kegiatan"))||[];
  data.push({
    tanggal:tglKegiatan.value,
    jenis:jenisKegiatan.value,
    uraian:uraian.value,
    hariKe,
    hst
  });

  localStorage.setItem("kegiatan",JSON.stringify(data));

  // reset input
  jenisKegiatan.value="";
  uraian.value="";
  infoHari.innerText="Hari ke-: - | HST: -";

  tampilRiwayat();
}

/* ===== RIWAYAT SEMENTARA ===== */
function tampilRiwayat(){
  const data=JSON.parse(localStorage.getItem("kegiatan"))||[];
  riwayat.innerHTML="<h3>üìñ Riwayat Kegiatan</h3>";

  data.sort((a,b)=>new Date(a.tanggal)-new Date(b.tanggal))
  .forEach(x=>{
    riwayat.innerHTML+=`
      <div class="card">
        <b>${formatTanggal(x.tanggal)}</b><br>
        Hari ke-${x.hariKe} | HST ${x.hst}<br>
        <b>${x.jenis}</b><br>
        ${x.uraian}
      </div>`;
  });
}

/* ===== INIT ===== */
const dataAwalTersimpan = JSON.parse(localStorage.getItem("dataAwal"));
if(dataAwalTersimpan){
  tampilHeader();
  dataAwalCard.classList.add("hidden");
  btnEditAwal.classList.remove("hidden");
}
tampilRiwayat();
</script>

</body>
</html>
