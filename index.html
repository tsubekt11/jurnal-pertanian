<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Jurnal Harian Pertanian</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{font-family:Arial;background:#f4f7f4;margin:0}
header{background:#2f7d32;color:#fff;padding:14px;text-align:center}

.card{
  background:#fff;
  margin:12px;
  padding:12px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1)
}

input,textarea,select,button{
  width:100%;
  padding:8px;
  margin-top:6px
}

button{
  background:#2f7d32;
  color:#fff;
  border:none;
  border-radius:6px;
  margin-top:10px;
  font-size:15px
}

.row{display:flex;gap:8px;align-items:center}
.tgl-kanan{width:160px}
.tgl-info{flex:1;font-size:18px;font-weight:bold}

.item-belanja{
  border:1px solid #ddd;
  border-radius:6px;
  padding:8px;
  margin-top:6px
}

.riwayat-item{
  margin-top:4px;
  padding-left:6px;
  border-left:3px solid #2f7d32
}

hr{margin:10px 0}
</style>
</head>

<body>
<header>
<h2>ðŸŒ¾ Jurnal Harian Pertanian</h2>
<p>Catatan kegiatan, biaya, dan modal</p>
</header>

<!-- DATA AWAL -->
<div class="card">
<b>ðŸ“Œ Data Awal Musim</b><br><br>

<b>Tanggal Mulai Olah Lahan (Hari ke-1)</b>
<div class="row">
  <input type="date" id="olah" class="tgl-kanan">
  <div class="tgl-info" id="infoOlah"></div>
</div>

<b>Tanggal Tanam</b>
<div class="row">
  <input type="date" id="tanam" class="tgl-kanan">
  <div class="tgl-info" id="infoTanam"></div>
</div>

<button onclick="simpanAwal()">Simpan Data Awal</button>
</div>

<!-- KEGIATAN -->
<div class="card">
<b>ðŸ““ Catatan Kegiatan</b>

<b>Tanggal</b>
<input type="date" id="tglKegiatan">

<b>Kegiatan</b>
<textarea id="kegiatan"></textarea>

<button onclick="simpanKegiatan()">ðŸ’¾ Simpan Kegiatan</button>
</div>

<!-- BIAYA -->
<div class="card">
<b>ðŸ’° Catatan Biaya & Modal</b>

<b>Tanggal</b>
<input type="date" id="tglBiaya">

<b>Jenis</b>
<select id="jenis" onchange="toggleBelanja()">
  <option>Belanja</option>
  <option>Upah</option>
  <option>Modal</option>
</select>

<div id="belanjaBox"></div>
<button onclick="tambahItem()">âž• Tambah Item Belanja</button>

<b>Keterangan (Upah / Modal)</b>
<input id="ket">

<b>Jumlah (Rp)</b>
<input type="number" id="jumlah">

<button onclick="simpanBiaya()">ðŸ’¾ Simpan</button>
</div>

<div class="card" id="ringkasan"></div>
<div class="card" id="riwayat"></div>

<script>
let itemsBelanja=[];

function formatHari(t){
  return new Date(t).toLocaleDateString("id-ID",{
    weekday:"long",day:"numeric",month:"long",year:"numeric"
  });
}

/* DATA AWAL */
function simpanAwal(){
  localStorage.setItem("olah",olah.value);
  localStorage.setItem("tanam",tanam.value);
  tampilAwal();
}

function tampilAwal(){
  if(olah.value) infoOlah.innerText=formatHari(olah.value);
  if(tanam.value) infoTanam.innerText=formatHari(tanam.value);
}

olah.value=localStorage.getItem("olah")||"";
tanam.value=localStorage.getItem("tanam")||"";
tampilAwal();

/* BELANJA */
function toggleBelanja(){
  belanjaBox.style.display = jenis.value==="Belanja" ? "block" : "none";
}

function tambahItem(){
  itemsBelanja.push({nama:"",qty:1,harga:0});
  renderBelanja();
}

function renderBelanja(){
  belanjaBox.innerHTML="<b>ðŸ§¾ Daftar Belanja</b>";
  let total=0;

  itemsBelanja.forEach((it,i)=>{
    const sub = it.qty * it.harga;
    total += sub;

    belanjaBox.innerHTML += `
    <div class="item-belanja">
      <b>${i+1}. ${it.nama || "Nama Barang"}</b><br>
      ${it.qty} x ${it.harga.toLocaleString()} = <b>${sub.toLocaleString()}</b>
    </div>`;
  });

  belanjaBox.innerHTML += `<hr><b>Total Belanja: Rp ${total.toLocaleString()}</b>`;
}

/* SIMPAN */
function simpanBiaya(){
  let data = JSON.parse(localStorage.getItem("biaya")) || [];
  let total = 0;

  if(jenis.value==="Belanja"){
    itemsBelanja.forEach(i=> total += i.qty*i.harga);
    data.push({
      tanggal: tglBiaya.value,
      jenis: "Belanja",
      items: itemsBelanja,
      total: total
    });
    itemsBelanja=[];
    renderBelanja();
  }else{
    data.push({
      tanggal: tglBiaya.value,
      jenis: jenis.value,
      ket: ket.value,
      total: +jumlah.value
    });
  }

  localStorage.setItem("biaya", JSON.stringify(data));
  tampil();
}

function simpanKegiatan(){
  let data = JSON.parse(localStorage.getItem("kegiatan")) || [];
  data.push({
    tanggal: tglKegiatan.value,
    teks: kegiatan.value
  });
  localStorage.setItem("kegiatan", JSON.stringify(data));
  tampil();
}

/* RIWAYAT TERKELOMPOK */
function tampil(){
  const keg = JSON.parse(localStorage.getItem("kegiatan")) || [];
  const bio = JSON.parse(localStorage.getItem("biaya")) || [];

  let grup = {};
  let modal=0, keluar=0;

  keg.forEach(k=>{
    if(!grup[k.tanggal]) grup[k.tanggal]=[];
    grup[k.tanggal].push({tipe:"kegiatan", data:k});
  });

  bio.forEach(b=>{
    if(!grup[b.tanggal]) grup[b.tanggal]=[];
    grup[b.tanggal].push({tipe:"biaya", data:b});
  });

  const urut = Object.keys(grup).sort((a,b)=>new Date(a)-new Date(b));

  riwayat.innerHTML="<h3>ðŸ“– Riwayat</h3>";

  urut.forEach(tgl=>{
    riwayat.innerHTML+=`<div class="card"><b>${formatHari(tgl)}</b>`;

    grup[tgl].forEach(x=>{
      if(x.tipe==="kegiatan"){
        riwayat.innerHTML+=`
          <div class="riwayat-item">ðŸ““ ${x.data.teks}</div>`;
      }
    });

    const belanja = grup[tgl].filter(x=>x.data.jenis==="Belanja");
    if(belanja.length){
      riwayat.innerHTML+=`<hr><b>ðŸ§¾ Belanja</b>`;
      belanja.forEach(b=>{
        b.data.items.forEach((i,n)=>{
          riwayat.innerHTML+=`
            <div class="riwayat-item">
              ${n+1}. ${i.nama} â€” ${i.qty} x ${i.harga.toLocaleString()}
              = <b>${(i.qty*i.harga).toLocaleString()}</b>
            </div>`;
        });
        riwayat.innerHTML+=`
          <div class="riwayat-item">
            <b>Total Belanja: Rp ${b.data.total.toLocaleString()}</b>
          </div>`;
        keluar+=b.data.total;
      });
    }

    const upah = grup[tgl].filter(x=>x.data.jenis==="Upah");
    if(upah.length){
      riwayat.innerHTML+=`<hr><b>ðŸ‘· Upah</b>`;
      upah.forEach(u=>{
        riwayat.innerHTML+=`
          <div class="riwayat-item">
            ${u.data.ket}<br>
            <b>Rp ${u.data.total.toLocaleString()}</b>
          </div>`;
        keluar+=u.data.total;
      });
    }

    const modalMasuk = grup[tgl].filter(x=>x.data.jenis==="Modal");
    if(modalMasuk.length){
      riwayat.innerHTML+=`<hr><b>ðŸ’µ Modal Masuk</b>`;
      modalMasuk.forEach(m=>{
        riwayat.innerHTML+=`
          <div class="riwayat-item">
            ${m.data.ket}<br>
            <b>Rp ${m.data.total.toLocaleString()}</b>
          </div>`;
        modal+=m.data.total;
      });
    }

    riwayat.innerHTML+=`</div>`;
  });

  ringkasan.innerHTML=`
    <b>ðŸ“Š Ringkasan</b><br>
    Modal Masuk: Rp ${modal.toLocaleString()}<br>
    Total Biaya: Rp ${keluar.toLocaleString()}<br>
    <b>Sisa Modal: Rp ${(modal-keluar).toLocaleString()}</b>`;
}

tampil();
</script>
</body>
</html>

